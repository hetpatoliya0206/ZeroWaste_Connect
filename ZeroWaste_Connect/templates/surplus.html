<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGO Dashboard | ZeroWaste Connect</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Fraunces:opsz,wght@9..144,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='surplus.css') }}">
</head>
<body>
    <main class="dashboard-shell">
        <section class="top-panel">
            <div>
                <p class="eyebrow">NGO Dashboard</p>
                <h1>Welcome {{ ngo_name }}</h1>
                <p class="subtitle">Track assigned food surplus and update your capacity.</p>
            </div>
            <a class="logout-link" href="{{ url_for('logout') }}">Logout</a>
        </section>

        <section class="stats-grid">
            <article class="stat-card"><h2>Total Surplus</h2><p>{{ total_surplus }}</p></article>
            <article class="stat-card"><h2>Collected</h2><p>{{ total_collected }}</p></article>
            <article class="stat-card"><h2>Assigned</h2><p>{{ total_assigned }}</p></article>
            <article class="stat-card"><h2>Current Capacity</h2><p>{{ capacity }}</p></article>
        </section>

        <section class="capacity-panel">
            <div class="capacity-head"><h3>Capacity Utilization</h3><span>{{ used_percentage }}%</span></div>
            <div class="progress-bar"><div class="progress-fill" style="width: {{ used_percentage }}%;"></div></div>
            <form method="POST" action="{{ url_for('update_capacity') }}" class="capacity-form">
                <input type="number" name="capacity" placeholder="New Capacity" required>
                <button type="submit">Update</button>
            </form>
        </section>

        <section class="records-panel">
            <h3>Active Assignments</h3>
            {% for row in records %}
            <article class="record-card">
                <p><strong>Donated By:</strong> {{ row[1] }}</p>
                <p><strong>Food:</strong> {{ row[2] }}</p>
                <p><strong>Qty:</strong> {{ row[3] }} | <strong>Expiry:</strong> {{ row[4] }}h</p>
                <p><strong>Distance:</strong> {{ "%.2f"|format(row[5]) }} KM</p>
                {% if row[6] == "Assigned" %}
                <a class="action-link" href="{{ url_for('mark_collected', surplus_id=row[0]) }}">Mark Collected</a>
                {% endif %}
            </article>
            {% else %}
            <p class="empty-state">No assigned records yet.</p>
            {% endfor %}
        </section>
    </main>
</body>
</html>
